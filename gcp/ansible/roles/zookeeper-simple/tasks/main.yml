---
- name: Pull Zookeeper image
  shell: docker pull confluentinc/cp-zookeeper:latest

- name: Stop existing Zookeeper container if running
  shell: docker stop zookeeper || true

- name: Remove existing Zookeeper container if exists
  shell: docker rm zookeeper || true

- name: Start Zookeeper container
  shell: |
    docker run -d \
      --name zookeeper \
      -p {{ zookeeper_port }}:{{ zookeeper_port }} \
      -v {{ data_dir }}:/data \
      -v {{ logs_dir }}:/logs \
      -e ZOOKEEPER_CLIENT_PORT={{ zookeeper_port }} \
      -e ZOOKEEPER_TICK_TIME=2000 \
      -e ZOOKEEPER_LOG4J_ROOT_LOGLEVEL=WARN \
      -e ZOOKEEPER_LOG4J_LOGGERS="org.apache.zookeeper=WARN" \
      --restart unless-stopped \
      confluentinc/cp-zookeeper:latest

- name: Wait for Zookeeper to be ready
  wait_for:
    port: "{{ zookeeper_port }}"
    host: "{{ ansible_default_ipv4.address }}"
    delay: 10
    timeout: 60

- name: Verify Zookeeper is running
  command: docker ps --filter name=zookeeper
  register: docker_ps_output
  changed_when: false

- name: Display running containers
  debug:
    var: docker_ps_output.stdout_lines